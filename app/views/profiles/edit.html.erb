<!-- app/views/profiles/edit.html.erb -->
<div class="container my-5">
  <div class="row">
    <div class="col-md-3">
      <div class="card mb-4">
        <div class="card-header">
          <h5 class="mb-0">Edit Profile</h5>
        </div>
        <div class="list-group list-group-flush">
          <a href="#personal" class="list-group-item list-group-item-action <%= params[:section] == 'personal' || params[:section].blank? ? 'active' : '' %>" data-bs-toggle="tab">
            Personal Information
          </a>
          <a href="#company" class="list-group-item list-group-item-action <%= params[:section] == 'company' ? 'active' : '' %>" data-bs-toggle="tab">
            Company Details
          </a>
          <a href="#address" class="list-group-item list-group-item-action <%= params[:section] == 'address' ? 'active' : '' %>" data-bs-toggle="tab">
            Address
          </a>
          <a href="#preferences" class="list-group-item list-group-item-action <%= params[:section] == 'preferences' ? 'active' : '' %>" data-bs-toggle="tab">
            Preferences
          </a>
        </div>
      </div>

      <div class="d-grid gap-2">
        <%= link_to "Cancel", profile_path, class: "btn btn-outline-secondary" %>
      </div>
    </div>

    <div class="col-md-9">
      <div class="card">
        <div class="card-body">
          <%= form_with(model: @user, url: profile_path, method: :patch) do |form| %>
            <div class="tab-content">
              <!-- Personal Information Tab -->
              <div class="tab-pane fade <%= params[:section] == 'personal' || params[:section].blank? ? 'show active' : '' %>" id="personal">
                <h4 class="mb-4">Personal Information</h4>

                <div class="row mb-3">
                  <div class="col-md-6">
                    <%= form.label :first_name, class: "form-label" %>
                    <%= form.text_field :first_name, class: "form-control" %>
                  </div>
                  <div class="col-md-6">
                    <%= form.label :last_name, class: "form-label" %>
                    <%= form.text_field :last_name, class: "form-control" %>
                  </div>
                </div>

                <div class="row mb-3">
                  <div class="col-md-6">
                    <%= form.label :email, class: "form-label" %>
                    <%= form.email_field :email, class: "form-control", disabled: true %>
                    <div class="form-text">To change your email, go to account settings.</div>
                  </div>
                  <div class="col-md-6">
                    <%= form.label :phone_number, class: "form-label" %>
                    <%= form.telephone_field :phone_number, class: "form-control" %>
                  </div>
                </div>

                <div class="row mb-3">
                  <div class="col-md-6">
                    <%= form.label :timezone, class: "form-label" %>
                    <%= form.time_zone_select :timezone, ActiveSupport::TimeZone.all.sort, { default: "UTC" }, { class: "form-select" } %>
                  </div>
                </div>
              </div>

              <!-- Company Details Tab -->
              <div class="tab-pane fade <%= params[:section] == 'company' ? 'show active' : '' %>" id="company">
                <h4 class="mb-4">Company Details</h4>

                <div class="row mb-3">
                  <div class="col-md-6">
                    <%= form.label :company_name, class: "form-label" %>
                    <%= form.text_field :company_name, class: "form-control" %>
                  </div>
                  <div class="col-md-6">
                    <%= form.label :business_type, class: "form-label" %>
                    <%= form.select :business_type,
                                    [
                                      ["Sole Proprietorship", "sole_proprietorship"],
                                      %w[LLC llc],
                                      %w[Partnership partnership],
                                      %w[Corporation corporation],
                                      ["S Corporation", "s_corporation"],
                                      %w[Nonprofit nonprofit],
                                      %w[Other other]
                                    ],
                                    { include_blank: "Select Business Type" },
                                    { class: "form-select" } %>
                  </div>
                </div>

                <div class="row mb-3">
                  <div class="col-md-6">
                    <%= form.label :industry, class: "form-label" %>
                    <%= form.select :industry,
                                    [
                                      %w[Technology technology],
                                      %w[Finance finance],
                                      %w[Healthcare healthcare],
                                      %w[Retail retail],
                                      %w[Manufacturing manufacturing],
                                      %w[Education education],
                                      %w[Services services],
                                      %w[Hospitality hospitality],
                                      %w[Construction construction],
                                      ["Real Estate", "real_estate"],
                                      %w[Other other]
                                    ],
                                    { include_blank: "Select Industry" },
                                    { class: "form-select" } %>
                  </div>
                  <div class="col-md-6">
                    <%= form.label :company_size, class: "form-label" %>
                    <%= form.select :company_size,
                                    [
                                      ["1 (Solo)", "solo"],
                                      ["2-10 employees", "small"],
                                      ["11-50 employees", "medium"],
                                      ["51-200 employees", "large"],
                                      ["201+ employees", "enterprise"]
                                    ],
                                    { include_blank: "Select Company Size" },
                                    { class: "form-select" } %>
                  </div>
                </div>
              </div>

              <!-- Address Tab -->
              <div class="tab-pane fade <%= params[:section] == 'address' ? 'show active' : '' %>" id="address">
                <h4 class="mb-4">Address Information</h4>

                <div class="mb-3">
                  <%= form.label :address_line1, "Address Line 1", class: "form-label" %>
                  <%= form.text_field :address_line1, class: "form-control" %>
                </div>

                <div class="mb-3">
                  <%= form.label :address_line2, "Address Line 2", class: "form-label" %>
                  <%= form.text_field :address_line2, class: "form-control" %>
                </div>

                <div class="row mb-3">
                  <div class="col-md-6">
                    <%= form.label :city, class: "form-label" %>
                    <%= form.text_field :city, class: "form-control" %>
                  </div>
                  <div class="col-md-6">
                    <%= form.label :state, "State/Province", class: "form-label" %>
                    <%= form.text_field :state, class: "form-control" %>
                  </div>
                </div>

                <div class="row mb-3">
                  <div class="col-md-6">
                    <%= form.label :zip_code, "Zip/Postal Code", class: "form-label" %>
                    <%= form.text_field :zip_code, class: "form-control" %>
                  </div>
                  <div class="col-md-6">
                    <%= form.label :country, class: "form-label" %>
                    <%= form.country_select :country, { priority_countries: %w[US CA GB] }, { class: "form-select" } %>
                  </div>
                </div>
              </div>

              <!-- Preferences Tab -->
              <div class="tab-pane fade <%= params[:section] == 'preferences' ? 'show active' : '' %>" id="preferences">
                <h4 class="mb-4">Preferences</h4>

                <div class="row mb-3">
                  <div class="col-md-6">
                    <%= form.label :currency, class: "form-label" %>
                    <%= form.select :currency,
                                    [
                                      ["USD - US Dollar", "USD"],
                                      ["EUR - Euro", "EUR"],
                                      ["GBP - British Pound", "GBP"],
                                      ["CAD - Canadian Dollar", "CAD"],
                                      ["AUD - Australian Dollar", "AUD"],
                                      ["JPY - Japanese Yen", "JPY"]
                                    ],
                                    {},
                                    { class: "form-select" } %>
                  </div>
                  <div class="col-md-6">
                    <%= form.label :fiscal_year_start, "Fiscal Year Start", class: "form-label" %>
                    <%= form.date_field :fiscal_year_start, class: "form-control" %>
                    <div class="form-text">This helps with annual financial reporting.</div>
                  </div>
                </div>
              </div>
            </div>

            <div class="d-grid gap-2 mt-4">
              <%= form.submit "Save Changes", class: "btn btn-primary" %>
            </div>
          <% end %>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
    document.addEventListener('turbo:load', function() {
        // Handle tab switching with URL params
        const urlParams = new URLSearchParams(window.location.search);
        const section = urlParams.get('section');

        if (section) {
            const tab = document.querySelector(`a[href="#${section}"]`);
            if (tab) {
                tab.click();
            }
        }
    });
</script>