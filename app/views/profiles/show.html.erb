<!-- app/views/profiles/show.html.erb -->
<div class="container my-5">
  <div class="row">
    <div class="col-md-3">
      <div class="card mb-4">
        <div class="card-body text-center">
          <div class="avatar-placeholder mb-3">
            <span class="avatar-text h1">
              <%= @user.first_name&.first&.upcase %><%= @user.last_name&.first&.upcase %>
            </span>
          </div>
          <h5 class="card-title"><%= @user.first_name %> <%= @user.last_name %></h5>
          <p class="text-muted"><%= @user.company_name %></p>
          <%= link_to "Edit Profile", edit_profile_path, class: "btn btn-primary" %>
        </div>
      </div>

      <div class="card">
        <div class="card-header">
          <h5 class="mb-0">Profile Completion</h5>
        </div>
        <div class="card-body">
          <%
            # Calculate profile completion percentage
            fields = [:first_name, :last_name, :phone_number, :company_name,
                      :address_line1, :city, :state, :country]
            completed = fields.count { |f| @user.send(f).present? }
            percentage = (completed.to_f / fields.size * 100).round
          %>
          <div class="text-center mb-3">
            <h2 class="mb-0"><%= percentage %>%</h2>
            <p class="text-muted">Profile Completed</p>
          </div>

          <div class="progress">
            <div class="progress-bar bg-success" role="progressbar" style="width: <%= percentage %>%"></div>
          </div>

          <% if percentage < 100 %>
            <div class="mt-3">
              <p>Complete your profile to get the most out of Cashly!</p>
            </div>
          <% end %>
        </div>
      </div>
    </div>

    <div class="col-md-9">
      <div class="card mb-4">
        <div class="card-header d-flex justify-content-between align-items-center">
          <h5 class="mb-0">Personal Information</h5>
          <%= link_to "Edit", edit_profile_path(section: "personal"), class: "btn btn-sm btn-outline-primary" %>
        </div>
        <div class="card-body">
          <div class="row mb-3">
            <div class="col-md-3 fw-bold">Email</div>
            <div class="col-md-9"><%= @user.email %></div>
          </div>

          <div class="row mb-3">
            <div class="col-md-3 fw-bold">Full Name</div>
            <div class="col-md-9">
              <% if @user.first_name.present? || @user.last_name.present? %>
                <%= "#{@user.first_name} #{@user.last_name}" %>
              <% else %>
                <span class="text-muted">Not provided</span>
              <% end %>
            </div>
          </div>

          <div class="row mb-3">
            <div class="col-md-3 fw-bold">Phone Number</div>
            <div class="col-md-9">
              <%= @user.phone_number.presence || '<span class="text-muted">Not provided</span>'.html_safe %>
            </div>
          </div>

          <div class="row">
            <div class="col-md-3 fw-bold">Time Zone</div>
            <div class="col-md-9">
              <%= @user.timezone.presence || 'UTC' %>
            </div>
          </div>
        </div>
      </div>

      <div class="card mb-4">
        <div class="card-header d-flex justify-content-between align-items-center">
          <h5 class="mb-0">Company Information</h5>
          <%= link_to "Edit", edit_profile_path(section: "company"), class: "btn btn-sm btn-outline-primary" %>
        </div>
        <div class="card-body">
          <div class="row mb-3">
            <div class="col-md-3 fw-bold">Company Name</div>
            <div class="col-md-9">
              <%= @user.company_name.presence || '<span class="text-muted">Not provided</span>'.html_safe %>
            </div>
          </div>

          <div class="row mb-3">
            <div class="col-md-3 fw-bold">Business Type</div>
            <div class="col-md-9">
              <%= @user.business_type.presence || '<span class="text-muted">Not provided</span>'.html_safe %>
            </div>
          </div>

          <div class="row mb-3">
            <div class="col-md-3 fw-bold">Industry</div>
            <div class="col-md-9">
              <%= @user.industry.presence || '<span class="text-muted">Not provided</span>'.html_safe %>
            </div>
          </div>

          <div class="row">
            <div class="col-md-3 fw-bold">Company Size</div>
            <div class="col-md-9">
              <%= @user.company_size.presence || '<span class="text-muted">Not provided</span>'.html_safe %>
            </div>
          </div>
        </div>
      </div>

      <div class="card">
        <div class="card-header d-flex justify-content-between align-items-center">
          <h5 class="mb-0">Address Information</h5>
          <%= link_to "Edit", edit_profile_path(section: "address"), class: "btn btn-sm btn-outline-primary" %>
        </div>
        <div class="card-body">
          <% if @user.address_line1.present? %>
            <address>
              <%= @user.address_line1 %><br>
              <%= @user.address_line2 %><br> if @user.address_line2.present?
              <%= @user.city %>, <%= @user.state %> <%= @user.zip_code %><br>
              <%= @user.country %>
            </address>
          <% else %>
            <p class="text-muted">No address information provided</p>
          <% end %>
        </div>
      </div>
    </div>
  </div>
</div>

<style>
    .avatar-placeholder {
        width: 100px;
        height: 100px;
        background-color: #6c757d;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto;
    }

    .avatar-text {
        color: white;
        font-weight: bold;
    }
</style>