<!-- app/views/invoices/index.html.erb -->
<div class="invoices-container">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h1>Invoices</h1>
    <%= link_to "Create New Invoice", new_invoice_path, class: "btn btn-primary" %>
  </div>

  <div class="row mb-4">
    <div class="col-md-3">
      <div class="card bg-light">
        <div class="card-body text-center">
          <h6 class="text-muted">Total Invoiced</h6>
          <h3><%= number_to_currency(@total_invoiced) %></h3>
        </div>
      </div>
    </div>

    <div class="col-md-3">
      <div class="card bg-light">
        <div class="card-body text-center">
          <h6 class="text-muted">Pending Payment</h6>
          <h3 class="text-primary"><%= number_to_currency(@pending_amount) %></h3>
        </div>
      </div>
    </div>

    <div class="col-md-3">
      <div class="card bg-light">
        <div class="card-body text-center">
          <h6 class="text-muted">Overdue</h6>
          <h3 class="text-danger"><%= number_to_currency(@overdue_amount) %></h3>
        </div>
      </div>
    </div>

    <div class="col-md-3">
      <div class="card bg-light">
        <div class="card-body text-center">
          <h6 class="text-muted">Invoices by Status</h6>
          <div class="d-flex justify-content-around">
            <div class="text-center">
              <span class="badge bg-warning"><%= @status_summary['pending'] || 0 %></span>
              <small class="d-block">Pending</small>
            </div>
            <div class="text-center">
              <span class="badge bg-success"><%= @status_summary['paid'] || 0 %></span>
              <small class="d-block">Paid</small>
            </div>
            <div class="text-center">
              <span class="badge bg-danger"><%= @status_summary['cancelled'] || 0 %></span>
              <small class="d-block">Cancelled</small>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="card">
    <div class="card-body">
      <% if @invoices.any? %>
        <div class="table-responsive">
          <table class="table table-hover">
            <thead>
            <tr>
              <th>Invoice #</th>
              <th>Client</th>
              <th>Amount</th>
              <th>Issue Date</th>
              <th>Due Date</th>
              <th>Status</th>
              <th>Actions</th>
            </tr>
            </thead>
            <tbody>
            <% @invoices.each do |invoice| %>
              <tr>
                <td><%= sprintf("INV-%05d", invoice.id) %></td>
                <td><%= invoice.client_name %></td>
                <td><%= number_to_currency(invoice.amount) %></td>
                <td><%= invoice.issue_date&.strftime('%Y-%m-%d') %></td>
                <td>
                  <%= invoice.due_date&.strftime('%Y-%m-%d') %>
                  <% if invoice.status == 'pending' && invoice.due_date && invoice.due_date < Date.today %>
                    <span class="badge bg-danger">Overdue</span>
                  <% end %>
                </td>
                <td>
                  <% if invoice.status == 'pending' %>
                    <span class="badge bg-warning">Pending</span>
                  <% elsif invoice.status == 'paid' %>
                    <span class="badge bg-success">Paid</span>
                  <% elsif invoice.status == 'cancelled' %>
                    <span class="badge bg-danger">Cancelled</span>
                  <% else %>
                    <span class="badge bg-secondary"><%= invoice.status.titleize %></span>
                  <% end %>
                </td>
                <td>
                  <%= link_to "View", invoice_path(invoice), class: "btn btn-sm btn-outline-primary" %>
                  <%= link_to "Edit", edit_invoice_path(invoice), class: "btn btn-sm btn-outline-secondary" %>
                  <%= link_to "Delete", invoice_path(invoice),
                              method: :delete,
                              data: { confirm: "Are you sure you want to delete this invoice?" },
                              class: "btn btn-sm btn-outline-danger" %>
                </td>
              </tr>
            <% end %>
            </tbody>
          </table>
        </div>
      <% else %>
        <div class="alert alert-info">
          <p class="mb-0">You don't have any invoices yet. <%= link_to "Create your first invoice", new_invoice_path %>.</p>
        </div>
      <% end %>
    </div>
  </div>
</div>
